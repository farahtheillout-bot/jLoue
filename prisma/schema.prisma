generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


enum UserRole {
  HOST
  GUEST
  ADMIN
}

enum ListingType {
  HOME
  ROOM
  EXPERIENCE
  ITEM
}

enum ListingStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum Currency {
  EUR
  USD
  GBP
  CHF
}

enum BookingUnit {
  HOUR
  DAY
  WEEK
}


model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      UserRole @default(GUEST)
  createdAt DateTime @default(now())

  listings  Listing[]
  bookings Booking[] @relation("UserBookings")

}

model Listing {
  id          Int           @id @default(autoincrement())
  type        ListingType
  title       String
  description String
  basePrice   Int           // centimes
  currency    Currency      @default(EUR)
  status      ListingStatus @default(DRAFT)

  bookingUnit BookingUnit   @default(DAY)
  minDuration Int           @default(1)
  maxDuration Int?
  checkInHour Int @default(12)
  timeZone String @default("UTC")
  quantity Int @default(1)

  owner       User          @relation(fields: [ownerId], references: [id])
  ownerId     Int

  images      ListingImage[]
  bookings    Booking[]

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  unavailableRanges UnavailableRange[]

}
model ListingImage {
  id        Int      @id @default(autoincrement())
  url       String
  position  Int      @default(0)

  listing   Listing  @relation(fields: [listingId], references: [id])
  listingId Int
}


model Booking {
  id         Int      @id @default(autoincrement())

  listing    Listing  @relation(fields: [listingId], references: [id])
  listingId  Int

renter    User @relation("UserBookings", fields: [renterId], references: [id])
renterId  Int

updatedAt DateTime @updatedAt

  startDate  DateTime
  endDate    DateTime

  totalPrice Int      // en centimes

  status     BookingStatus @default(PENDING)
  expiresAt DateTime?
  createdAt  DateTime @default(now())
}

model UnavailableRange {
  id        Int      @id @default(autoincrement())
  startDate DateTime
  endDate   DateTime
  reason    String?  // ex: "maintenance", "déjà loué"

  listing   Listing  @relation(fields: [listingId], references: [id])
  listingId Int

  createdAt DateTime @default(now())
}
